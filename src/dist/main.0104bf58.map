{"version":3,"sources":["utils/control-point.js","utils/path.js","utils/end-point.js","utils/pen.js","utils/main.js"],"names":["pointStyle","control_point_radius","control_point_color","ControlPoint","x","y","ratio","ctx","beginPath","arc","Math","PI","draw","save","strokeStyle","fillStyle","stroke","fill","restore","isPointInPath","Path","isClose","cep","i","len","length","isInPoint","ep","cp","forEach","selected","splice","oed","ed","Object","setPrototypeOf","prototype","Array","end_point_length","mouse_end_point_length","end_point_color","stroke_width","fill_color","hover_fill_color","EndPoint","cp0","cp1","cpBalance","lineWidth","print","line","x1","y1","x2","y2","color","moveTo","lineTo","controlPoint","sqrt","pow","counterpart","staticDistance","distanceOfPoint","dynamicDistance","Pen","targetCvs","sourceCvs","canvas","document","querySelector","getContext","stroke_color","paths","push","dragging","editCpBalance","isNewEndPoint","currentEndPoint","draggingControlPoint","width","height","active","bbox","getBoundingClientRect","left","top","e","console","log","location","positionToCanvas","clientX","clientY","selectedPath","getSelectedPath","isExistPoint","removeSelectedEndPoint","ced","createPath","createEndPoint","path","addEndPoint","renderer","preventDefault","loc","style","cursor","calculateControlPoint","offset","keyCode","deleteEndPoint","that","listeners","mousedown","onMouseDown","mousemove","onMouseMove","mouseup","onMouseUp","keydown","onKeyDown","addEventListener","len1","j","len2","removeSelected","l","deleteSelected","prev_ep","clearRect","printControlPoints","bezierCurveTo","window","loadImg","imgCanvas","imgCtx","img","Image","onload","w","h","drawImage","pen","reset","src","require"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,aAAa;AACjBC,wBAAsB,CADL;AAEjBC,uBAAqB;AAFJ,CAAnB;;IAIaC,uBAAAA;AACX,wBAAYC,CAAZ,EAAeC,CAAf,EAAkB;AAAA;;AAChB,SAAKD,CAAL,GAASA,KAAK,CAAd;AACA,SAAKC,CAAL,GAASA,KAAK,CAAd;AACD;;AAED;;;;;yBACKC,OAAO;AACVA,cAAQA,SAAS,CAAjB;AACA,WAAKC,GAAL,CAASC,SAAT;AACA,WAAKD,GAAL,CAASE,GAAT,CAAa,KAAKL,CAAL,GAASE,KAAtB,EAA6B,KAAKD,CAAL,GAASC,KAAtC,EAA6CN,WAAWC,oBAAxD,EAA8E,CAA9E,EAAiFS,KAAKC,EAAL,GAAU,CAA3F,EAA8F,KAA9F;AACD;;;0BACKL,OAAO;AACX,WAAKM,IAAL,CAAUN,KAAV;AACA,WAAKC,GAAL,CAASM,IAAT;AACA,WAAKN,GAAL,CAASO,WAAT,GAAuBd,WAAWE,mBAAlC;AACA,WAAKK,GAAL,CAASQ,SAAT,GAAqBf,WAAWE,mBAAhC;AACA,WAAKK,GAAL,CAASS,MAAT;AACA,WAAKT,GAAL,CAASU,IAAT;AACA,WAAKV,GAAL,CAASW,OAAT;AACD;;;8BACSd,GAAGC,GAAG;AACd,WAAKO,IAAL;AACA,UAAG,KAAKL,GAAL,CAASY,aAAT,CAAuBf,CAAvB,EAA0BC,CAA1B,CAAH,EAAiC;AAC/B,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;;;;;;;;;;;;;;;AC/BH;;;;IACae,eAAAA;AACX,kBAA8B;AAAA,QAAjBC,OAAiB,uEAAP,KAAO;;AAAA;;AAC5B;AACA,SAAKA,OAAL,GAAeA,OAAf,CAF4B,CAEJ;AAEzB;;;;8BAESjB,GAAGC,GAAG;AACd,UAAIiB,YAAJ;AACA,WAAI,IAAIC,IAAI,CAAR,EAAUC,MAAM,KAAKC,MAAzB,EAAiCF,IAAIC,GAArC,EAA0CD,GAA1C,EAA8C;AAC5CD,cAAM,KAAKC,CAAL,EAAQG,SAAR,CAAkBtB,CAAlB,EAAqBC,CAArB,CAAN;AACA,YAAGiB,GAAH,EAAO;AACL,iBAAO;AACHK,gBAAI,KAAKJ,CAAL,CADD;AAEHK,gBAAKN,4CAA8BA,GAA9B,GAAoC;AAFtC,WAAP;AAID;AACF;AACD,aAAO,IAAP;AACD;;;qCAEgB;AACf,WAAKO,OAAL,CAAa,UAACF,EAAD,EAAQ;AACnBA,WAAGG,QAAH,GAAc,KAAd;AACD,OAFD;AAGD;;;qCAEgB;AACf,WAAI,IAAIP,IAAI,CAAR,EAAWC,MAAM,KAAKC,MAA1B,EAAkCF,IAAIC,GAAtC,EAA2CD,GAA3C,EAA+C;AAC7C,YAAG,KAAKA,CAAL,EAAQO,QAAX,EAAoB;AAClB,eAAKC,MAAL,CAAYR,CAAZ,EAAe,CAAf;AACAC,gBAAM,KAAKC,MAAX;AACAF;AACD;AACF;AACF;;;gCAEWS,KAAKC,IAAI;AACnB,WAAI,IAAIV,IAAI,CAAR,EAAWC,MAAM,KAAKC,MAA1B,EAAkCF,IAAIC,GAAtC,EAA2CD,GAA3C,EAA+C;AAC7C,YAAG,KAAKA,CAAL,MAAYS,GAAf,EAAmB;AACf,eAAKD,MAAL,CAAYR,IAAI,CAAhB,EAAmB,CAAnB,EAAsBU,EAAtB;AACH;AACF;AACF;;;;;;AAEHC,OAAOC,cAAP,CAAsBf,KAAKgB,SAA3B,EAAsCC,MAAMD,SAA5C;;;;;;;;;;;AC9CA;;;;AACA,IAAMpC,aAAa;AACjBsC,oBAAkB,CADD;AAEjBC,0BAAwB,EAFP;AAGjBC,mBAAiB,SAHA,EAGW;AAC5BC,gBAAc,CAJG,EAIA;AACjBC,cAAY,SALK,EAKM;AACvBC,oBAAkB,SAND,CAMW;AANX,CAAnB;;IAQaC,mBAAAA;AACX,oBAAYxC,CAAZ,EAAeC,CAAf,EAAkBwC,GAAlB,EAAuBC,GAAvB,EAA4B;AAAA;;AAC1B,SAAK1C,CAAL,GAASA,KAAK,CAAd;AACA,SAAKC,CAAL,GAASA,KAAK,CAAd;AACA,SAAKyB,QAAL,GAAgB,KAAhB,CAH0B,CAGJ;AACtB,SAAKe,GAAL,GAAWA,OAAO,+BAAiBzC,CAAjB,EAAoBC,CAApB,CAAlB;AACA,SAAKyC,GAAL,GAAWA,OAAO,+BAAiB1C,CAAjB,EAAoBC,CAApB,CAAlB;AACA,SAAK0C,SAAL,GAAiB,IAAjB,CAN0B,CAMH;AACxB;;;;yBAEIzC,OAAO;AACVA,cAAQA,SAAS,CAAjB;AACA,WAAKC,GAAL,CAASC,SAAT;AACA,WAAKD,GAAL,CAASE,GAAT,CAAa,KAAKL,CAAL,GAASE,KAAtB,EAA6B,KAAKD,CAAL,GAASC,KAAtC,EAA6CN,WAAWsC,gBAAxD,EAA0E,CAA1E,EAA6E5B,KAAKC,EAAL,GAAU,CAAvF,EAA0F,KAA1F;AACD;;;0BAEKL,OAAO;AACXA,cAAQA,SAAS,CAAjB;AACA,WAAKM,IAAL,CAAUN,KAAV;AACA,WAAKC,GAAL,CAASM,IAAT;AACA,WAAKN,GAAL,CAASO,WAAT,GAAuBd,WAAWwC,eAAlC;AACA,WAAKjC,GAAL,CAASQ,SAAT,GAAqBf,WAAW0C,UAAhC;AACA,WAAKnC,GAAL,CAASyC,SAAT,GAAqBhD,WAAWyC,YAAhC;AACA,UAAG,KAAKX,QAAR,EAAiB;AACf,aAAKvB,GAAL,CAASQ,SAAT,GAAqBf,WAAW2C,gBAAhC;AACD;AACD,WAAKpC,GAAL,CAASU,IAAT;AACA,WAAKV,GAAL,CAASS,MAAT;AACA,WAAKT,GAAL,CAASW,OAAT;AACD;;AAED;;;;uCACmBZ,OAAO;AACxBA,cAAQA,SAAS,CAAjB;AACA,WAAK2C,KAAL,CAAW3C,KAAX;AACA,UAAG,CAAC,KAAKwB,QAAT,EAAmB;AACjB;AACD;AACD,UAAG,KAAKe,GAAL,CAASzC,CAAT,KAAe,KAAKA,CAApB,IAAyB,KAAKyC,GAAL,CAASxC,CAAT,KAAe,KAAKA,CAAhD,EAAkD;AAChD,aAAKwC,GAAL,CAASI,KAAT,CAAe3C,KAAf;AACA,aAAK4C,IAAL,CAAU,KAAKL,GAAL,CAASzC,CAAnB,EAAsB,KAAKyC,GAAL,CAASxC,CAA/B,EAAkC,KAAKD,CAAvC,EAAyC,KAAKC,CAA9C,EAAiD,KAAKE,GAAtD,EAA2DP,WAAWwC,eAAtE;AACD;AACD,UAAG,KAAKM,GAAL,CAAS1C,CAAT,KAAe,KAAKA,CAApB,IAAyB,KAAK0C,GAAL,CAASzC,CAAT,KAAe,KAAKA,CAAhD,EAAkD;AAChD,aAAKyC,GAAL,CAASG,KAAT,CAAe3C,KAAf;AACA,aAAK4C,IAAL,CAAU,KAAKJ,GAAL,CAAS1C,CAAnB,EAAsB,KAAK0C,GAAL,CAASzC,CAA/B,EAAkC,KAAKD,CAAvC,EAAyC,KAAKC,CAA9C,EAAiD,KAAKE,GAAtD,EAA2DP,WAAWwC,eAAtE;AACD;AACF;AACD;;;;yBACKW,IAAIC,IAAIC,IAAIC,IAAI/C,KAAKgD,OAAM;AAC9BhD,UAAIM,IAAJ;AACAN,UAAIC,SAAJ;AACAD,UAAIiD,MAAJ,CAAWL,EAAX,EAAeC,EAAf;AACA7C,UAAIO,WAAJ,GAAkByC,KAAlB;AACAhD,UAAIkD,MAAJ,CAAWJ,EAAX,EAAeC,EAAf;AACA/C,UAAIS,MAAJ;AACAT,UAAIW,OAAJ;AACD;;;8BAESd,GAAGC,GAAG;AACd,WAAKO,IAAL;AACA,UAAG,KAAKL,GAAL,CAASY,aAAT,CAAuBf,CAAvB,EAA0BC,CAA1B,CAAH,EAAiC;AAC7B,eAAO,IAAP;AACH;AACD,UAAG,KAAKyB,QAAR,EAAiB;AACf,YAAG,KAAKe,GAAL,CAASnB,SAAT,CAAmBtB,CAAnB,EAAsBC,CAAtB,CAAH,EAA4B;AAC1B,iBAAO,KAAKwC,GAAZ;AACD;AACD,YAAG,KAAKC,GAAL,CAASpB,SAAT,CAAmBtB,CAAnB,EAAsBC,CAAtB,CAAH,EAA4B;AAC1B,iBAAO,KAAKyC,GAAZ;AACD;AACF;AACD,aAAO,KAAP;AACD;;;oCAEeY,cAAc;AAC5B,aAAOhD,KAAKiD,IAAL,CACLjD,KAAKkD,GAAL,CAAS,KAAKxD,CAAL,GAASsD,aAAatD,CAA/B,EAAkC,CAAlC,IAAuCM,KAAKkD,GAAL,CAAS,KAAKvD,CAAL,GAASqD,aAAarD,CAA/B,EAAkC,CAAlC,CADlC,CAAP;AAGD;;;0CAEqBD,GAAGC,GAAGqD,cAAc;AACxC,UAAG,KAAKX,SAAR,EAAmB;AACjBW,qBAAaG,WAAb,GACEH,iBAAiB,KAAKb,GAAtB,GAA4B,KAAKC,GAAjC,GAAuC,KAAKD,GAD9C;AAGAa,qBAAaG,WAAb,CAAyBC,cAAzB,GAA0CJ,aAAaG,WAAb,CAAyBC,cAAzB,GACAJ,aAAaG,WAAb,CAAyBC,cADzB,GAEA,KAAKC,eAAL,CAAqBL,aAAaG,WAAlC,CAF1C;;AAIA,YAAIC,iBAAiBJ,aAAaG,WAAb,CAAyBC,cAA9C;AACA,YAAIE,kBAAkB,KAAKD,eAAL,CAAqBL,YAArB,CAAtB;;AAEAA,qBAAaG,WAAb,CAAyBzD,CAAzB,GAA6B0D,iBAAiBE,eAAjB,IAAoC,KAAK5D,CAAL,GAASA,CAA7C,IAAkD,KAAKA,CAApF;AACAsD,qBAAaG,WAAb,CAAyBxD,CAAzB,GAA6ByD,iBAAiBE,eAAjB,IAAoC,KAAK3D,CAAL,GAASA,CAA7C,IAAkD,KAAKA,CAApF;AACD;AACDqD,mBAAatD,CAAb,GAAiBA,CAAjB;AACAsD,mBAAarD,CAAb,GAAiBA,CAAjB;AACD;;;;;;;;;;;;;;;AC1GH;;AACA;;AACA;;;;IAEa4D,cAAAA;AACX,iBAAqE;AAAA,QAAxDC,SAAwD,uEAA5C,cAA4C;AAAA,QAA5BC,SAA4B,uEAAhB,cAAgB;;AAAA;;AACnE,SAAKC,MAAL,GAAcC,SAASC,aAAT,CAAuBJ,SAAvB,CAAd;AACA,SAAKC,SAAL,GAAiBE,SAASC,aAAT,CAAuBH,SAAvB,CAAjB;AACA,SAAK5D,GAAL,GAAW,KAAK6D,MAAL,CAAYG,UAAZ,CAAuB,IAAvB,CAAX;AACA,SAAKC,YAAL,GAAoB,SAApB,CAJmE,CAIrC;AAC/B;;;;4BACQ;AACP,WAAKC,KAAL,GAAa,EAAb;AACA,WAAKA,KAAL,CAAWC,IAAX,CAAgB,gBAAhB;;AAEA,WAAKC,QAAL,GAAgB,KAAhB,CAJO,CAIgB;AACvB,WAAKC,aAAL,GAAqB,KAArB,CALO,CAKoB;AAC3B,WAAKC,aAAL,GAAqB,KAArB,CANO,CAMqB;AAC5B,WAAKC,eAAL,GAAuB,IAAvB,CAPO,CAOsB;AAC7B,WAAKC,oBAAL,GAA4B,IAA5B,CARO,CAQ2B;AAClC;;AAEA,iCAAa3C,SAAb,CAAuB7B,GAAvB,GAA6B,KAAKA,GAAlC;AACA,yBAAS6B,SAAT,CAAmB7B,GAAnB,GAAyB,KAAKA,GAA9B;AACA,yBAAS6B,SAAT,CAAmBgC,MAAnB,GAA4B,IAA5B;;AAEA,WAAKA,MAAL,CAAYY,KAAZ,GAAoB,KAAKb,SAAL,CAAea,KAAnC;AACA,WAAKZ,MAAL,CAAYa,MAAZ,GAAqB,KAAKd,SAAL,CAAec,MAApC;AACA,WAAKC,MAAL;AACD;;AAED;;;;qCACkB9E,GAAGC,GAAG;AACtB,UAAI8E,OAAO,KAAKf,MAAL,CAAYgB,qBAAZ,EAAX;AACA,aAAO;AACLhF,WAAGA,IAAI+E,KAAKE,IAAL,IAAa,KAAKjB,MAAL,CAAYY,KAAZ,GAAqBG,KAAKH,KAAvC,CADF;AAEL3E,WAAGA,IAAI8E,KAAKG,GAAL,IAAa,KAAKlB,MAAL,CAAYa,MAAZ,GAAqBE,KAAKF,MAAvC;AAFF,OAAP;AAID;AACD;;;;gCACYM,GAAG;AACbC,cAAQC,GAAR,CAAY,WAAZ,EAAyBF,CAAzB;;AAEA,UAAIG,WAAW,KAAKC,gBAAL,CAAsBJ,EAAEK,OAAxB,EAAiCL,EAAEM,OAAnC,CAAf;AACA,UAAIC,eAAe,KAAKC,eAAL,EAAnB;;AAEA,WAAKpB,QAAL,GAAgB,IAAhB;AACA,WAAKE,aAAL,GAAqB,KAArB;AACA,WAAKE,oBAAL,GAA4B,KAA5B;AACA,WAAKD,eAAL,GAAuB,KAAKkB,YAAL,CAAkBN,SAAStF,CAA3B,EAA8BsF,SAASrF,CAAvC,CAAvB;AACA,WAAK4F,sBAAL;;AAEA,UAAG,KAAKnB,eAAR,EAAyB;AACvB;AACA,aAAKA,eAAL,CAAqBhD,QAArB,GAAgC,IAAhC;;AAEA,YAAG,KAAK8C,aAAL,IAAsB,CAAC,KAAKG,oBAA/B,EAAqD;AACnD,cAAImB,MAAM,KAAKpB,eAAf;AACAoB,cAAInD,SAAJ,GAAgB,IAAhB;AACAmD,cAAIrD,GAAJ,CAAQzC,CAAR,GAAY8F,IAAIpD,GAAJ,CAAQ1C,CAAR,GAAY8F,IAAI9F,CAA5B;AACA8F,cAAIrD,GAAJ,CAAQxC,CAAR,GAAY6F,IAAIpD,GAAJ,CAAQzC,CAAR,GAAY6F,IAAI7F,CAA5B;AACA,eAAKwE,aAAL,GAAqB,IAArB;AACD;;AAED,YAAG,CAAC,KAAKE,oBAAN,IAA8B,KAAKD,eAAL,KAAyB,KAAKL,KAAL,CAAW,KAAKA,KAAL,CAAWhD,MAAX,GAAmB,CAA9B,EAAiC,CAAjC,CAAvD,IAA8F,KAAKgD,KAAL,CAAW,KAAKA,KAAL,CAAWhD,MAAX,GAAmB,CAA9B,EAAiCA,MAAjC,GAA0C,CAA3I,EAA6I;AACzI;AACA;AACA,eAAK0E,UAAL;AACH;AACF,OAjBD,MAiBO;AACJ,aAAKrB,eAAL,GAAuB,KAAKsB,cAAL,CAAoBV,SAAStF,CAA7B,EAAgCsF,SAASrF,CAAzC,CAAvB;AACA,aAAKwE,aAAL,GAAqB,IAArB;AACA,YAAG,KAAKD,aAAL,IAAsBkB,YAAzB,EAAsC;AACnC;AACDA,uBAAaO,IAAb,CAAkBC,WAAlB,CAA8BR,aAAanE,EAA3C,EAA+C,KAAKmD,eAApD;AACF,SAHA,MAGK;AACJ,eAAKL,KAAL,CAAW,KAAKA,KAAL,CAAWhD,MAAX,GAAoB,CAA/B,EAAkCiD,IAAlC,CAAuC,KAAKI,eAA5C;AACD;AACF;AACD,WAAKyB,QAAL;AACD;;;gCAEWhB,GAAG;AACbA,QAAEiB,cAAF;;AAEA,UAAG,CAAC,KAAK7B,QAAT,EAAmB;AACjB;AACD;AACD,UAAI8B,MAAM,KAAKd,gBAAL,CAAsBJ,EAAEK,OAAxB,EAAiCL,EAAEM,OAAnC,CAAV;AACA,UAAIK,MAAM,KAAKpB,eAAf;;AAEA,WAAKV,MAAL,CAAYsC,KAAZ,CAAkBC,MAAlB,GAA2B,MAA3B;;AAEA,UAAG,KAAK9B,aAAR,EAAsB;AAClBqB,YAAIpD,GAAJ,CAAQ1C,CAAR,GAAYqG,IAAIrG,CAAhB;AACA8F,YAAIpD,GAAJ,CAAQzC,CAAR,GAAYoG,IAAIpG,CAAhB;;AAEA6F,YAAIrD,GAAJ,CAAQzC,CAAR,GAAY8F,IAAI9F,CAAJ,GAAQ,CAAR,GAAYqG,IAAIrG,CAA5B;AACA8F,YAAIrD,GAAJ,CAAQxC,CAAR,GAAY6F,IAAI7F,CAAJ,GAAQ,CAAR,GAAYoG,IAAIpG,CAA5B;AACH,OAND,MAMO,IAAI,KAAK0E,oBAAT,EAA8B;AACjC;AACAS,gBAAQC,GAAR,CAAY,uBAAZ;;AAEA,YAAG,KAAKb,aAAR,EAAsB;AAClBsB,cAAInD,SAAJ,GAAgB,KAAhB;AACH;AACD,aAAKgC,oBAAL,CAA0B3E,CAA1B,GAA8BqG,IAAIrG,CAAlC;AACA,aAAK2E,oBAAL,CAA0B1E,CAA1B,GAA8BoG,IAAIpG,CAAlC;AACA6F,YAAIU,qBAAJ,CAA0BH,IAAIrG,CAA9B,EAAiCqG,IAAIpG,CAArC,EAAwC,KAAK0E,oBAA7C;AACH,OAVM,MAUA;AACH;AACA,YAAI8B,SAAS;AACXzG,aAAGqG,IAAIrG,CAAJ,GAAQ8F,IAAI9F,CADJ;AAEXC,aAAGoG,IAAIpG,CAAJ,GAAM6F,IAAI7F;AAFF,SAAb;AAIA6F,YAAI9F,CAAJ,GAAQqG,IAAIrG,CAAZ;AACA8F,YAAI7F,CAAJ,GAAQoG,IAAIpG,CAAZ;;AAEA6F,YAAIpD,GAAJ,CAAQ1C,CAAR,IAAayG,OAAOzG,CAApB;AACA8F,YAAIpD,GAAJ,CAAQzC,CAAR,IAAawG,OAAOxG,CAApB;AACA6F,YAAIrD,GAAJ,CAAQzC,CAAR,IAAayG,OAAOzG,CAApB;AACA8F,YAAIrD,GAAJ,CAAQxC,CAAR,IAAawG,OAAOxG,CAApB;AACH;AACD,WAAKkG,QAAL;AACD;;;8BACShB,GAAG;AACX;AACA,WAAKnB,MAAL,CAAYsC,KAAZ,CAAkBC,MAAlB,GAA2B,SAA3B;AACA,WAAKhC,QAAL,GAAgB,KAAhB;AACA,UAAG,KAAKI,oBAAR,EAA6B;AAC3B,YAAG,KAAKA,oBAAL,CAA0BlB,WAA7B,EAA0C;AACxC,iBAAO,KAAKkB,oBAAL,CAA0BlB,WAA1B,CAAsCC,cAA7C;AACD;AACD,eAAO,KAAKiB,oBAAL,CAA0BlB,WAAjC;AACA,aAAKkB,oBAAL,GAA4B,KAA5B;AACD;AACF;;AAED;;;;8BACUQ,GAAG;AACX,cAAOA,EAAEuB,OAAT;AACE,aAAK,CAAL;AACEvB,YAAEiB,cAAF;AACA,eAAKO,cAAL;AACA,eAAKR,QAAL;AAJJ;AAMD;AACD;;;;6BACS;AACP,UAAIS,OAAO,IAAX;AACA,UAAIC,YAAY;AACdC,iBADc,qBACJ3B,CADI,EACD;AAAEyB,eAAKG,WAAL,CAAiB5B,CAAjB;AAAqB,SADtB;AAEd6B,iBAFc,qBAEJ7B,CAFI,EAED;AAAEyB,eAAKK,WAAL,CAAiB9B,CAAjB;AAAqB,SAFtB;AAGd+B,eAHc,mBAGN/B,CAHM,EAGH;AAAEyB,eAAKO,SAAL,CAAehC,CAAf;AAAmB,SAHlB;AAIdiC,eAJc,mBAINjC,CAJM,EAIH;AAAEyB,eAAKS,SAAL,CAAelC,CAAf;AAAmB;AAJlB,OAAhB;AAMA,WAAKnB,MAAL,CAAYsD,gBAAZ,CAA6B,WAA7B,EAA0CT,UAAUC,SAApD,EAA+D,KAA/D;AACA,WAAK9C,MAAL,CAAYsD,gBAAZ,CAA6B,WAA7B,EAA0CT,UAAUG,SAApD,EAA+D,KAA/D;AACA,WAAKhD,MAAL,CAAYsD,gBAAZ,CAA6B,SAA7B,EAAwCT,UAAUK,OAAlD,EAA2D,KAA3D;AACAjD,eAASqD,gBAAT,CAA0B,SAA1B,EAAqCT,UAAUO,OAA/C,EAAwD,KAAxD;AACD;;;iCAGY;AACX,WAAK/C,KAAL,CAAW,KAAKA,KAAL,CAAWhD,MAAX,GAAoB,CAA/B,EAAkCJ,OAAlC,GAA4C,IAA5C;AACA,WAAKoD,KAAL,CAAWC,IAAX,CAAgB,gBAAhB;AACD;;;sCAEiB;AAChB,WAAI,IAAInD,IAAI,CAAR,EAAWoG,OAAO,KAAKlD,KAAL,CAAWhD,MAAjC,EAAyCF,IAAIoG,IAA7C,EAAmDpG,GAAnD,EAAuD;AACrD,aAAI,IAAIqG,IAAI,CAAR,EAAWC,OAAO,KAAKpD,KAAL,CAAWlD,CAAX,EAAcE,MAApC,EAA4CmG,IAAIC,IAAhD,EAAsDD,GAAtD,EAA0D;AACxD,cAAG,KAAKnD,KAAL,CAAWlD,CAAX,EAAcqG,CAAd,EAAiB9F,QAApB,EAA6B;AAC3B,mBAAO;AACLuE,oBAAM,KAAK5B,KAAL,CAAWlD,CAAX,CADD;AAELI,kBAAI,KAAK8C,KAAL,CAAWlD,CAAX,EAAcqG,CAAd;AAFC,aAAP;AAID;AACF;AACF;AACD,aAAO,IAAP;AACD;;;6CAEwB;AACvB,WAAKnD,KAAL,CAAW5C,OAAX,CAAmB,UAACwE,IAAD,EAAU;AACzBA,aAAKyB,cAAL;AACH,OAFD;AAGD;;;mCAEc1H,GAAGC,GAAG;AACnB,UAAIsB,KAAK,uBAAavB,CAAb,EAAgBC,CAAhB,CAAT;AACAsB,SAAGG,QAAH,GAAc,IAAd;AACA,aAAOH,EAAP;AACD;;AAED;;;;qCACiB;AACf,UAAI8C,QAAQ,KAAKA,KAAjB;AACA,WAAI,IAAIlD,IAAI,CAAR,EAAWwG,IAAItD,MAAMhD,MAAzB,EAAiCF,IAAIwG,CAArC,EAAwCxG,GAAxC,EAA4C;AAC1CkD,cAAMlD,CAAN,EAASyG,cAAT;AACA,YAAGvD,MAAMlD,CAAN,EAASE,MAAT,KAAoB,CAApB,IAA0BF,IAAI,CAAJ,KAAUwG,CAAvC,EAA0C;AACxCtD,gBAAM1C,MAAN,CAAaR,CAAb,EAAgB,CAAhB;AACAwG,cAAItD,MAAMhD,MAAV;AACAF;AACD;AACF;AACF;;;iCAEYnB,GAAGC,GAAG;AACjB,UAAIiB,YAAJ;AAAA,UAASC,IAAI,CAAb;AAAA,UAAgBwG,UAAhB;AACA,WAAIA,IAAI,KAAKtD,KAAL,CAAWhD,MAAnB,EAA2BF,IAAGwG,CAA9B,EAAiCxG,GAAjC,EAAqC;AACnCD,cAAM,KAAKmD,KAAL,CAAWlD,CAAX,EAAcG,SAAd,CAAwBtB,CAAxB,EAA2BC,CAA3B,CAAN;AACA,YAAGiB,GAAH,EAAO;AACL,cAAGA,IAAIM,EAAJ,sCAAH,EAAkC;AAC9B;AACA,iBAAKmD,oBAAL,GAA4BzD,IAAIM,EAAhC;AACH;AACD,iBAAON,IAAIK,EAAX;AACD;AACF;AACD,aAAO,IAAP;AACD;AACD;;;;+BACW;AAAA;;AACT,UAAIA,WAAJ;AAAA,UAAQsG,gBAAR;AAAA,UAAiB1H,MAAM,KAAKA,GAA5B;;AAEA,WAAKA,GAAL,CAAS2H,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAK9D,MAAL,CAAYY,KAArC,EAA4C,KAAKZ,MAAL,CAAYa,MAAxD;;AAEA,WAAKR,KAAL,CAAW5C,OAAX,CAAmB,UAACwE,IAAD,EAAU;AAC3B,YAAI7E,MAAM6E,KAAK5E,MAAf;AACA,aAAI,IAAIF,IAAI,CAAZ,EAAeA,IAAIC,GAAnB,EAAwBD,GAAxB,EAA6B;AAC3BI,eAAK0E,KAAK9E,CAAL,CAAL;AACAI,aAAGwG,kBAAH;AACA,cAAG5G,IAAI,CAAP,EAAU;AACR;AACA0G,sBAAU5B,KAAK9E,IAAI,CAAT,CAAV;AACA,kBAAK6G,aAAL,CAAmBH,OAAnB,EAA4BtG,EAA5B,EAAgCpB,GAAhC;AACD;AACF;AACD,YAAG8F,KAAKhF,OAAR,EAAgB;AACZ4G,oBAAU5B,KAAK7E,MAAM,CAAX,CAAV;AACAG,eAAK0E,KAAK,CAAL,CAAL;AACA,gBAAK+B,aAAL,CAAmBH,OAAnB,EAA4BtG,EAA5B,EAAgCpB,GAAhC;AACH;AACF,OAhBD;AAiBD;;;kCAEa0H,SAAStG,IAAIpB,KAAK;AAC9BA,UAAIM,IAAJ;AACAN,UAAIC,SAAJ;AACAD,UAAIO,WAAJ,GAAkB,KAAK0D,YAAvB;AACAjE,UAAIyC,SAAJ,GAAgB,CAAhB;AACAzC,UAAIiD,MAAJ,CAAWyE,QAAQ7H,CAAnB,EAAsB6H,QAAQ5H,CAA9B;AACAE,UAAI6H,aAAJ,CACIH,QAAQnF,GAAR,CAAY1C,CADhB,EACmB6H,QAAQnF,GAAR,CAAYzC,CAD/B,EAEIsB,GAAGkB,GAAH,CAAOzC,CAFX,EAEcuB,GAAGkB,GAAH,CAAOxC,CAFrB,EAGIsB,GAAGvB,CAHP,EAGUuB,GAAGtB,CAHb;AAKA;AACAE,UAAIS,MAAJ;AACAT,UAAIW,OAAJ;AACD;;;;;;;;;;ACpQH;;AACAmH,OAAOX,gBAAP,CAAwB,MAAxB,EAAgCY,OAAhC,EAAyC,KAAzC;;AAEA,IAAIC,YAAYlE,SAASC,aAAT,CAAuB,cAAvB,CAAhB;AACA,IAAIkE,SAASD,UAAUhE,UAAV,CAAqB,IAArB,CAAb;AACA;AACA,SAAS+D,OAAT,GAAmB;AACjB,MAAIG,MAAM,IAAIC,KAAJ,EAAV;AACAD,MAAIE,MAAJ,GAAa,YAAM;AACjB,QAAIC,IAAIH,IAAIzD,KAAZ;AACA,QAAI6D,IAAIJ,IAAIxD,MAAZ;;AAEAuD,WAAON,SAAP,CAAiB,CAAjB,EAAoB,CAApB,EAAuBK,UAAUvD,KAAjC,EAAwCuD,UAAUtD,MAAlD;AACAsD,cAAUvD,KAAV,GAAkB4D,IAAI,GAAtB;AACAL,cAAUtD,MAAV,GAAmB4D,IAAI,GAAvB;AACAL,WAAOM,SAAP,CAAiBL,GAAjB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4BG,IAAI,GAAhC,EAAqCC,IAAI,GAAzC;;AAEA;AACA,QAAIE,MAAM,cAAV;AACAA,QAAIC,KAAJ;AACD,GAZD;AAaAP,MAAIQ,GAAJ,GAAUC,QAAQ,mBAAR,CAAV;AACD","file":"main.0104bf58.map","sourcesContent":["const pointStyle = {\n  control_point_radius: 4,\n  control_point_color: '#005cf9'\n}\nexport class ControlPoint {\n  constructor(x, y) {\n    this.x = x || 0\n    this.y = y || 0\n  }\n  \n  /* 画控制点 */\n  draw(ratio) {\n    ratio = ratio || 1\n    this.ctx.beginPath()\n    this.ctx.arc(this.x * ratio, this.y * ratio, pointStyle.control_point_radius, 0, Math.PI * 2, false)\n  }\n  print(ratio) {\n    this.draw(ratio)\n    this.ctx.save()\n    this.ctx.strokeStyle = pointStyle.control_point_color\n    this.ctx.fillStyle = pointStyle.control_point_color\n    this.ctx.stroke()\n    this.ctx.fill()\n    this.ctx.restore()\n  }\n  isInPoint(x, y) {\n    this.draw()\n    if(this.ctx.isPointInPath(x, y)) {\n      return true\n    }\n    return false\n  }\n}","import { ControlPoint } from './control-point'\nexport class Path{\n  constructor (isClose = false) {\n    // super()\n    this.isClose = isClose  // 路径是否关闭\n\n  }\n\n  isInPoint(x, y) {\n    let cep\n    for(let i = 0,len = this.length; i < len; i++){\n      cep = this[i].isInPoint(x, y)\n      if(cep){\n        return {\n            ep: this[i], \n            cp : cep instanceof ControlPoint ? cep : null\n        }\n      }\n    }\n    return null\n  }\n\n  removeSelected() {\n    this.forEach((ep) => {\n      ep.selected = false\n    })\n  }\n\n  deleteSelected() {\n    for(let i = 0, len = this.length; i < len; i++){\n      if(this[i].selected){\n        this.splice(i, 1)\n        len = this.length\n        i--\n      }\n    }\n  }\n\n  addEndPoint(oed, ed) {\n    for(let i = 0, len = this.length; i < len; i++){\n      if(this[i] === oed){\n          this.splice(i + 1, 0, ed);\n      }\n    }\n  }\n}\nObject.setPrototypeOf(Path.prototype, Array.prototype);","import { ControlPoint } from './control-point'\nconst pointStyle = {\n  end_point_length: 5,\n  mouse_end_point_length: 10,\n  end_point_color: '#5d5d5d', // 轮廓颜色\n  stroke_width: 2, // 轮廓宽度\n  fill_color: '#ffffff', // 填充颜色\n  hover_fill_color: '#ffc107' // 选中时的填充颜色\n}\nexport class EndPoint {\n  constructor(x, y, cp0, cp1) {\n    this.x = x || 0\n    this.y = y || 0\n    this.selected = false // endpoint被选中\n    this.cp0 = cp0 || new ControlPoint(x, y)\n    this.cp1 = cp1 || new ControlPoint(x, y)\n    this.cpBalance = true  // 控制平衡点\n  }\n\n  draw(ratio) {\n    ratio = ratio || 1\n    this.ctx.beginPath()\n    this.ctx.arc(this.x * ratio, this.y * ratio, pointStyle.end_point_length, 0, Math.PI * 2, false)\n  }\n\n  print(ratio) {\n    ratio = ratio || 1\n    this.draw(ratio)\n    this.ctx.save()\n    this.ctx.strokeStyle = pointStyle.end_point_color\n    this.ctx.fillStyle = pointStyle.fill_color\n    this.ctx.lineWidth = pointStyle.stroke_width\n    if(this.selected){\n      this.ctx.fillStyle = pointStyle.hover_fill_color\n    }\n    this.ctx.fill()\n    this.ctx.stroke()\n    this.ctx.restore()\n  }\n  \n  // 绘制控制点\n  printControlPoints(ratio) {\n    ratio = ratio || 1\n    this.print(ratio)\n    if(!this.selected) {\n      return\n    }\n    if(this.cp0.x !== this.x || this.cp0.y !== this.y){\n      this.cp0.print(ratio)\n      this.line(this.cp0.x, this.cp0.y, this.x,this.y, this.ctx, pointStyle.end_point_color)\n    }\n    if(this.cp1.x !== this.x || this.cp1.y !== this.y){\n      this.cp1.print(ratio)\n      this.line(this.cp1.x, this.cp1.y, this.x,this.y, this.ctx, pointStyle.end_point_color)\n    }\n  }\n  // draw line\n  line(x1, y1, x2, y2, ctx, color){\n    ctx.save()\n    ctx.beginPath()\n    ctx.moveTo(x1, y1)\n    ctx.strokeStyle = color\n    ctx.lineTo(x2, y2)\n    ctx.stroke()\n    ctx.restore()\n  }\n\n  isInPoint(x, y) {\n    this.draw()\n    if(this.ctx.isPointInPath(x, y)) {\n        return this\n    }\n    if(this.selected){\n      if(this.cp0.isInPoint(x, y)){\n        return this.cp0;\n      }\n      if(this.cp1.isInPoint(x, y)){\n        return this.cp1;\n      }\n    }\n    return false\n  }\n\n  distanceOfPoint(controlPoint) {\n    return Math.sqrt(\n      Math.pow(this.x - controlPoint.x, 2) + Math.pow(this.y - controlPoint.y, 2)\n    )\n  }\n\n  calculateControlPoint(x, y, controlPoint) {\n    if(this.cpBalance) {\n      controlPoint.counterpart = (\n        controlPoint === this.cp0 ? this.cp1 : this.cp0\n      )\n      controlPoint.counterpart.staticDistance = controlPoint.counterpart.staticDistance\n                                              ? controlPoint.counterpart.staticDistance \n                                              : this.distanceOfPoint(controlPoint.counterpart)\n\n      let staticDistance = controlPoint.counterpart.staticDistance\n      let dynamicDistance = this.distanceOfPoint(controlPoint)\n\n      controlPoint.counterpart.x = staticDistance / dynamicDistance * (this.x - x) + this.x\n      controlPoint.counterpart.y = staticDistance / dynamicDistance * (this.y - y) + this.y\n    }\n    controlPoint.x = x\n    controlPoint.y = y\n  }\n}","import { ControlPoint } from './control-point'\nimport { Path } from './path'\nimport { EndPoint } from './end-point'\n\nexport class Pen {\n  constructor (targetCvs = '#matting-pen', sourceCvs = '#matting-img') {\n    this.canvas = document.querySelector(targetCvs)\n    this.sourceCvs = document.querySelector(sourceCvs)\n    this.ctx = this.canvas.getContext('2d')\n    this.stroke_color = '#ffc107' // 线条颜色\n  }\n  reset () {\n    this.paths = []\n    this.paths.push(new Path())\n\n    this.dragging = false  // 是否正在拖动\n    this.editCpBalance = false // 控制点平衡\n    this.isNewEndPoint = false  // 是否新点\n    this.currentEndPoint = null  // 当前点\n    this.draggingControlPoint = null  // 当前控制点\n    // this.zoomRatio = 1  // 缩放比例\n\n    ControlPoint.prototype.ctx = this.ctx\n    EndPoint.prototype.ctx = this.ctx\n    EndPoint.prototype.canvas = this\n \n    this.canvas.width = this.sourceCvs.width\n    this.canvas.height = this.sourceCvs.height\n    this.active()\n  }\n\n  // the positoin on canvas\n  positionToCanvas (x, y) {\n    let bbox = this.canvas.getBoundingClientRect()\n    return {\n      x: x - bbox.left * (this.canvas.width  / bbox.width),\n      y: y - bbox.top  * (this.canvas.height / bbox.height)\n    }\n  }\n  // mouse click\n  onMouseDown(e) {\n    console.log('mousedown', e)\n\n    let location = this.positionToCanvas(e.clientX, e.clientY)\n    let selectedPath = this.getSelectedPath()\n\n    this.dragging = true\n    this.isNewEndPoint = false\n    this.draggingControlPoint = false\n    this.currentEndPoint = this.isExistPoint(location.x, location.y)\n    this.removeSelectedEndPoint()\n\n    if(this.currentEndPoint ){\n      // if the endPoint exist\n      this.currentEndPoint.selected = true;\n\n      if(this.editCpBalance && !this.draggingControlPoint) {\n        let ced = this.currentEndPoint\n        ced.cpBalance = true\n        ced.cp0.x = ced.cp1.x = ced.x\n        ced.cp0.y = ced.cp1.y = ced.y\n        this.isNewEndPoint = true\n      }\n\n      if(!this.draggingControlPoint && this.currentEndPoint === this.paths[this.paths.length -1][0] && this.paths[this.paths.length -1].length > 2){\n          // click first endpoint\n          // close path\n          this.createPath()\n      }\n    } else {\n       this.currentEndPoint = this.createEndPoint(location.x, location.y)\n       this.isNewEndPoint = true;\n       if(this.editCpBalance && selectedPath){\n          // add endpoint to selectedendpoint after\n         selectedPath.path.addEndPoint(selectedPath.ep, this.currentEndPoint)\n      }else {\n        this.paths[this.paths.length - 1].push(this.currentEndPoint)\n      }\n    }\n    this.renderer()\n  }\n\n  onMouseMove(e) {\n    e.preventDefault()\n\n    if(!this.dragging) {\n      return\n    }\n    let loc = this.positionToCanvas(e.clientX, e.clientY)\n    let ced = this.currentEndPoint\n\n    this.canvas.style.cursor = 'move'\n\n    if(this.isNewEndPoint){\n        ced.cp1.x = loc.x\n        ced.cp1.y = loc.y\n\n        ced.cp0.x = ced.x * 2 - loc.x\n        ced.cp0.y = ced.y * 2 - loc.y\n    } else if (this.draggingControlPoint){\n        // Dragging controlPoint\n        console.log('dragging controlPoint')\n\n        if(this.editCpBalance){\n            ced.cpBalance = false\n        }\n        this.draggingControlPoint.x = loc.x\n        this.draggingControlPoint.y = loc.y\n        ced.calculateControlPoint(loc.x, loc.y, this.draggingControlPoint)\n    } else {\n        // Dragging endpoint\n        let offset = {\n          x: loc.x - ced.x,\n          y: loc.y-ced.y\n        }\n        ced.x = loc.x\n        ced.y = loc.y\n\n        ced.cp1.x += offset.x\n        ced.cp1.y += offset.y\n        ced.cp0.x += offset.x\n        ced.cp0.y += offset.y\n    }\n    this.renderer()\n  }\n  onMouseUp(e) {\n    // console.log('mouseup', e)\n    this.canvas.style.cursor = 'default'\n    this.dragging = false\n    if(this.draggingControlPoint){\n      if(this.draggingControlPoint.counterpart) {\n        delete this.draggingControlPoint.counterpart.staticDistance\n      }\n      delete this.draggingControlPoint.counterpart\n      this.draggingControlPoint = false\n    }\n  }\n\n  // key down: provide delete endPoint\n  onKeyDown(e) {\n    switch(e.keyCode) {\n      case 8: \n        e.preventDefault()\n        this.deleteEndPoint()\n        this.renderer()\n    }\n  }\n  // active the canvas's eventListner\n  active() {\n    let that = this\n    let listeners = {\n      mousedown(e) { that.onMouseDown(e) },\n      mousemove(e) { that.onMouseMove(e) },\n      mouseup(e) { that.onMouseUp(e) },\n      keydown(e) { that.onKeyDown(e) }\n  };\n    this.canvas.addEventListener('mousedown', listeners.mousedown, false)\n    this.canvas.addEventListener('mousemove', listeners.mousemove, false)\n    this.canvas.addEventListener('mouseup', listeners.mouseup, false)\n    document.addEventListener('keydown', listeners.keydown, false)\n  }\n\n\n  createPath() {\n    this.paths[this.paths.length - 1].isClose = true\n    this.paths.push(new Path())\n  }\n\n  getSelectedPath() {\n    for(let i = 0, len1 = this.paths.length; i < len1; i++){\n      for(let j = 0, len2 = this.paths[i].length; j < len2; j++){\n        if(this.paths[i][j].selected){\n          return {\n            path: this.paths[i],\n            ep: this.paths[i][j]\n          }\n        }\n      }\n    }\n    return null\n  }\n\n  removeSelectedEndPoint() {\n    this.paths.forEach((path) => {\n        path.removeSelected()\n    })\n  }\n\n  createEndPoint(x, y) {\n    let ep = new EndPoint(x, y)\n    ep.selected = true\n    return ep\n  }\n\n  // delete point\n  deleteEndPoint() {\n    let paths = this.paths\n    for(let i = 0, l = paths.length; i < l; i++){\n      paths[i].deleteSelected()\n      if(paths[i].length === 0 && (i + 1 !== l)){\n        paths.splice(i, 1)\n        l = paths.length\n        i--\n      }\n    }\n  }\n\n  isExistPoint(x, y) {\n    let cep, i = 0, l\n    for(l = this.paths.length; i< l; i++){\n      cep = this.paths[i].isInPoint(x, y)\n      if(cep){\n        if(cep.cp instanceof ControlPoint){\n            // set  controlpoint\n            this.draggingControlPoint = cep.cp\n        }\n        return cep.ep\n      }\n    }\n    return null\n  }\n  // renderer the spline\n  renderer() {\n    let ep, prev_ep, ctx = this.ctx\n\n    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)\n\n    this.paths.forEach((path) => {\n      let len = path.length\n      for(let i = 0; i < len; i++) {\n        ep = path[i]\n        ep.printControlPoints()\n        if(i > 0) {\n          // draw line\n          prev_ep = path[i - 1];\n          this.bezierCurveTo(prev_ep, ep, ctx)\n        }\n      }\n      if(path.isClose){\n          prev_ep = path[len - 1]\n          ep = path[0]\n          this.bezierCurveTo(prev_ep, ep, ctx)\n      }\n    })\n  }\n\n  bezierCurveTo(prev_ep, ep, ctx) {\n    ctx.save()\n    ctx.beginPath()\n    ctx.strokeStyle = this.stroke_color\n    ctx.lineWidth = 2\n    ctx.moveTo(prev_ep.x, prev_ep.y)\n    ctx.bezierCurveTo(\n        prev_ep.cp1.x, prev_ep.cp1.y,\n        ep.cp0.x, ep.cp0.y,\n        ep.x, ep.y\n    )\n    // ctx.quadraticCurveTo(prev_ep.cp1.x, prev_ep.cp1.y, ep.x, ep.y)\n    ctx.stroke()\n    ctx.restore()\n  }\n}\n\n","import { Pen } from './pen'\nwindow.addEventListener('load', loadImg, false);\n\nlet imgCanvas = document.querySelector('#matting-img');\nlet imgCtx = imgCanvas.getContext('2d');\n// img example \nfunction loadImg() {\n  let img = new Image()\n  img.onload = () => {\n    let w = img.width\n    let h = img.height\n\n    imgCtx.clearRect(0, 0, imgCanvas.width, imgCanvas.height)\n    imgCanvas.width = w * 1.5\n    imgCanvas.height = h * 1.2\n    imgCtx.drawImage(img, 0, 0, w * 1.5, h * 1.2)\n\n    // Use class Pen here \n    let pen = new Pen()\n    pen.reset()\n  }\n  img.src = require('../img/tianer.jpg')\n}\n"]}